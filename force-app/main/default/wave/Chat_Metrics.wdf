["{}","{\"nodes\":{\"FORMULA7\":{\"sources\":[\"FILTER2\"],\"action\":\"computeRelative\",\"parameters\":{\"partitionBy\":[\"WorkItemId\"],\"orderBy\":[{\"fieldName\":\"CreatedDate\",\"direction\":\"DESC\"}],\"expressionType\":\"SQL\",\"fields\":[{\"formulaExpression\":\"row_number()\",\"defaultValue\":\"\",\"precision\":10,\"name\":\"mostRecentCheck\",\"scale\":0,\"label\":\"mostRecentCheck\",\"type\":\"NUMBER\"}]}},\"FORMULA8_copy0\":{\"sources\":[\"FORMULA6_copy0\"],\"action\":\"formula\",\"parameters\":{\"expressionType\":\"SQL\",\"fields\":[{\"formulaExpression\":\"''\",\"defaultValue\":\"\",\"precision\":255,\"name\":\"Team\",\"label\":\"Team\",\"type\":\"TEXT\"}]}},\"FORMULA10\":{\"sources\":[\"LOAD_DATASET6\"],\"action\":\"formula\",\"parameters\":{\"expressionType\":\"SQL\",\"fields\":[{\"formulaExpression\":\"case array(array_contains(array(2, 3, 4, 5, 6), dayofweek(\\\"CreatedDate\\\")),array_contains(array(14, 15, 16, 17, 18, 19, 20, 21, 22, 23), hour(\\\"CreatedDate\\\")))\\n\\twhen array(TRUE,TRUE)\\n\\tthen 'Inside'\\n\\telse\\n\\t'Outside'\\nend\",\"defaultValue\":\"\",\"precision\":255,\"name\":\"Business_Hours\",\"label\":\"Business Hours\",\"type\":\"TEXT\"}]}},\"FORMULA3_copy0\":{\"sources\":[\"FORMULA2_copy0\"],\"action\":\"computeRelative\",\"parameters\":{\"partitionBy\":[\"Join4.Id\"],\"orderBy\":[{\"fieldName\":\"checkEngagement\",\"direction\":\"ASC\"}],\"expressionType\":\"SQL\",\"fields\":[{\"formulaExpression\":\"case array(array_contains(array(first_value(checkEngagement), last_value(checkEngagement)), 'Engaged'), \\\"Join4.AgentType\\\" = 'Bot')\\n\\twhen array(TRUE,FALSE)\\n\\tthen 'Engaged'\\n\\twhen array(TRUE,TRUE)\\n\\tthen 'Engaged'\\n\\twhen array(FALSE,TRUE)\\n\\tthen 'Bot'\\n\\telse\\n\\t'Abandoned'\\nend\",\"defaultValue\":\"\",\"precision\":255,\"name\":\"User_Interaction\",\"label\":\"User Interaction\",\"type\":\"TEXT\"}]}},\"LOAD_DATASET6\":{\"sources\":[],\"action\":\"load\",\"parameters\":{\"fields\":[\"Id\",\"CaseNumber\",\"Subject\",\"CreatedDate\",\"CreatedById\"],\"sampleDetails\":{\"sortBy\":[],\"type\":\"TopN\"},\"dataset\":{\"sourceObjectName\":\"Case\",\"label\":\"Case\",\"connectionName\":\"SFDC_LOCAL\",\"type\":\"connectedDataset\"}}},\"LOAD_DATASET5\":{\"sources\":[],\"action\":\"load\",\"parameters\":{\"fields\":[\"Team__c\",\"Id\",\"Name\"],\"sampleDetails\":{\"sortBy\":[],\"type\":\"TopN\"},\"dataset\":{\"sourceObjectName\":\"User\",\"label\":\"User\",\"connectionName\":\"SFDC_LOCAL\",\"type\":\"connectedDataset\"}}},\"OUTPUT0\":{\"sources\":[\"UPDATE0\"],\"action\":\"save\",\"parameters\":{\"measuresToCurrencies\":[],\"fields\":[],\"dataset\":{\"name\":\"ChatData\",\"label\":\"ChatData\",\"folderName\":\"TestBotDeflection\",\"type\":\"analyticsDataset\"}}},\"LOAD_DATASET3\":{\"sources\":[],\"action\":\"load\",\"parameters\":{\"fields\":[\"ConversationId\",\"Seq\",\"EntryTime\",\"ActorType\",\"ActorId\"],\"sampleDetails\":{\"sortBy\":[],\"filters\":{\"filterExpressions\":[{\"operands\":[\"1751328000000\"],\"field\":\"EntryTime\",\"type\":\"DATETIME\",\"operator\":\"GREATER_OR_EQUAL\"}]},\"type\":\"Custom\"},\"dataset\":{\"sourceObjectName\":\"ConversationEntry\",\"label\":\"ConversationEntry\",\"connectionName\":\"SFDC_LOCAL\",\"type\":\"connectedDataset\"}}},\"LOAD_DATASET2\":{\"sources\":[],\"action\":\"load\",\"parameters\":{\"fields\":[\"Id\",\"OwnerId\",\"IsDeleted\",\"Name\",\"CreatedDate\",\"CreatedById\",\"LastModifiedDate\",\"LastModifiedById\",\"SystemModstamp\",\"UserId\",\"WorkItemId\",\"Status\",\"ServiceChannelId\",\"OriginalQueueId\",\"CapacityWeight\",\"CapacityPercentage\",\"RequestDateTime\",\"AcceptDateTime\",\"DeclineDateTime\",\"CloseDateTime\",\"SpeedToAnswer\",\"AgentCapacityWhenDeclined\",\"PendingServiceRoutingId\",\"PushTimeout\",\"PushTimeoutDateTime\",\"HandleTime\",\"ActiveTime\",\"DeclineReason\",\"CancelDateTime\",\"ShouldSkipCapacityCheck\",\"RoutingType\",\"RoutingModel\",\"RoutingPriority\",\"AssignedDateTime\",\"PreferredUserId\",\"OriginalGroupId\",\"AfterConversationActualTime\"],\"sampleDetails\":{\"sortBy\":[],\"filters\":{\"filterExpressions\":[{\"operands\":[\"1751328000000\"],\"field\":\"CreatedDate\",\"type\":\"DATETIME\",\"operator\":\"GREATER_OR_EQUAL\"}]},\"type\":\"Custom\"},\"dataset\":{\"sourceObjectName\":\"AgentWork\",\"label\":\"AgentWork\",\"connectionName\":\"SFDC_LOCAL\",\"type\":\"connectedDataset\"}}},\"UPDATE0\":{\"sources\":[\"JOIN1\",\"FILTER3\"],\"action\":\"update\",\"parameters\":{\"leftKeys\":[\"Transform1.Join4.Id\"],\"rightKeys\":[\"WorkItemId\"],\"updateColumns\":{\"Transform1.Join4.Session_Owner__c\":\"User.Name\",\"Transform1.Team\":\"User.Team__c\",\"Transform1.Join4.OwnerId\":\"UserId\"}}},\"LOAD_DATASET0\":{\"sources\":[],\"action\":\"load\",\"parameters\":{\"fields\":[\"Id\",\"Name\",\"CreatedDate\",\"CreatedById\",\"SystemModstamp\",\"MessagingEndUserId\",\"CaseId\",\"AcceptTime\",\"StartTime\",\"EndTime\",\"AgentType\",\"ConversationId\",\"ChannelName\",\"EndUserMessageCount\",\"AgentMessageCount\",\"EndedByType\",\"Session_Owner__c\",\"OwnerId\"],\"sampleDetails\":{\"sortBy\":[],\"filters\":{\"filterExpressions\":[{\"operands\":[\"1751328000000\"],\"field\":\"CreatedDate\",\"type\":\"DATETIME\",\"operator\":\"GREATER_OR_EQUAL\"}]},\"type\":\"Custom\"},\"dataset\":{\"sourceObjectName\":\"MessagingSession\",\"label\":\"MessagingSession\",\"connectionName\":\"SFDC_LOCAL\",\"type\":\"connectedDataset\"}}},\"FORMULA2_copy0\":{\"sources\":[\"JOIN6\"],\"action\":\"computeRelative\",\"parameters\":{\"partitionBy\":[\"Join4.Id\"],\"orderBy\":[{\"fieldName\":\"Seq\",\"direction\":\"ASC\"}],\"expressionType\":\"SQL\",\"fields\":[{\"formulaExpression\":\"case concat(\\\"ActorType\\\", lag(\\\"ActorType\\\"))\\n\\twhen 'EndUserAgent'\\n\\tthen 'Engaged'\\n\\telse\\n\\t''\\nend\",\"defaultValue\":\"\",\"precision\":255,\"name\":\"checkEngagement\",\"label\":\"checkEngagement\",\"type\":\"TEXT\"}]}},\"FORMULA0\":{\"sources\":[\"JOIN3\"],\"action\":\"formula\",\"parameters\":{\"expressionType\":\"SQL\",\"fields\":[{\"formulaExpression\":\"to_unix_timestamp(\\\"AssignedDateTime\\\") - to_unix_timestamp(\\\"RequestDateTime\\\")\",\"defaultValue\":\"\",\"precision\":10,\"name\":\"Time_Waiting_For_Availability\",\"scale\":0,\"label\":\"Time(s) Waiting For Availability\",\"type\":\"NUMBER\"}]}},\"FORMULA1\":{\"sources\":[\"FORMULA0\"],\"action\":\"formula\",\"parameters\":{\"expressionType\":\"SQL\",\"fields\":[{\"formulaExpression\":\"to_unix_timestamp(\\\"AcceptDateTime\\\") - to_unix_timestamp(\\\"AssignedDateTime\\\")\",\"defaultValue\":\"\",\"precision\":10,\"name\":\"Time_Waiting_For_Accept\",\"scale\":0,\"label\":\"Time(s) Waiting For Accept\",\"type\":\"NUMBER\"}]}},\"FORMULA5\":{\"sources\":[\"FORMULA1\"],\"action\":\"formula\",\"parameters\":{\"expressionType\":\"SQL\",\"fields\":[{\"formulaExpression\":\"case \\\"User.Name\\\"\\n\\twhen 'Automated Process'\\n\\tthen 0\\n\\telse\\n\\t\\\"HandleTime\\\"\\nend\",\"defaultValue\":\"\",\"precision\":10,\"name\":\"UserHandleTime\",\"scale\":0,\"label\":\"User Handle Time\",\"type\":\"NUMBER\"}]}},\"EXTRACT0\":{\"sources\":[\"FORMULA5\"],\"action\":\"extractGrains\",\"parameters\":{\"grainExtractions\":[]}},\"FILTER0\":{\"sources\":[\"JOIN5\"],\"action\":\"sqlFilter\",\"parameters\":{\"sqlFilterExpression\":\"\\\"EntryTime\\\" >= \\\"Join4.CreatedDate\\\" AND \\\"EntryTime\\\" <= \\\"Join4.EndTime\\\"\"}},\"FORMULA9_copy0\":{\"sources\":[\"FORMULA8_copy0\"],\"action\":\"formula\",\"parameters\":{\"expressionType\":\"SQL\",\"fields\":[{\"formulaExpression\":\"case array(User_Interaction, substr(\\\"BotCase.Id\\\", 0, 3))\\n\\twhen array('Bot', '500')\\n\\tthen 'Created Case'\\n    when array('Bot', null)\\n    then 'Deflected'\\n\\telse\\n\\t'Transferred'\\nend\",\"defaultValue\":\"\",\"precision\":255,\"name\":\"Bot_Result\",\"label\":\"Bot Result\",\"type\":\"TEXT\"}]}},\"FILTER1\":{\"sources\":[\"FORMULA9_copy0\"],\"action\":\"filter\",\"parameters\":{\"filterExpressions\":[{\"operands\":[\"1\"],\"field\":\"dupeCheck\",\"type\":\"NUMBER\",\"operator\":\"EQUAL\"}]}},\"FILTER2\":{\"sources\":[\"JOIN3\"],\"action\":\"filter\",\"parameters\":{\"filterExpressions\":[{\"operands\":[\"Automated Process\"],\"field\":\"User.Name\",\"type\":\"TEXT\",\"operator\":\"NOT\"}]}},\"FILTER3\":{\"sources\":[\"FORMULA7\"],\"action\":\"filter\",\"parameters\":{\"filterExpressions\":[{\"operands\":[\"1\"],\"field\":\"mostRecentCheck\",\"type\":\"NUMBER\",\"operator\":\"EQUAL\"}]}},\"AGGREGATE1\":{\"sources\":[\"EXTRACT0\"],\"action\":\"aggregate\",\"parameters\":{\"groupings\":[\"WorkItemId\"],\"pivots\":[],\"nodeType\":\"STANDARD\",\"aggregations\":[{\"name\":\"SUM_ActiveTime\",\"action\":\"SUM\",\"source\":\"ActiveTime\",\"label\":\"Sum of Active Time\"},{\"name\":\"SUM_HandleTime\",\"action\":\"SUM\",\"source\":\"HandleTime\",\"label\":\"Sum of Handle Time\"},{\"name\":\"SUM_Time_Waiting_For_Accept\",\"action\":\"SUM\",\"source\":\"Time_Waiting_For_Accept\",\"label\":\"Sum of Time(s) Waiting For Accept\"},{\"name\":\"SUM_Time_Waiting_For_Availability\",\"action\":\"SUM\",\"source\":\"Time_Waiting_For_Availability\",\"label\":\"Sum of Time(s) Waiting For Availability\"},{\"name\":\"SUM_AfterConversationActualTime\",\"action\":\"SUM\",\"source\":\"AfterConversationActualTime\",\"label\":\"Sum of After Conversation Work Actual Time\"},{\"name\":\"SUM_SpeedToAnswer\",\"action\":\"SUM\",\"source\":\"SpeedToAnswer\",\"label\":\"Sum of Speed To Answer\"},{\"name\":\"COUNT_Rows\",\"action\":\"COUNT\",\"label\":\"Rows\"},{\"name\":\"SUM_UserHandleTime\",\"action\":\"SUM\",\"source\":\"UserHandleTime\",\"label\":\"Sum of User Handle Time\"}]}},\"JOIN1\":{\"schema\":{\"slice\":{\"mode\":\"DROP\",\"ignoreMissingFields\":true,\"fields\":[\"Transform1.ActorId\",\"Transform1.ActorType\",\"Transform1.ConversationId\",\"Transform1.EntryTime\",\"Transform1.Id\",\"Transform1.Seq\",\"Transform1.checkEngagement\",\"Transform1.dupeCheck\",\"WorkItemId\"]},\"fields\":[]},\"sources\":[\"AGGREGATE1\",\"FILTER1\"],\"action\":\"join\",\"parameters\":{\"leftKeys\":[\"WorkItemId\"],\"rightQualifier\":\"Transform1\",\"rightKeys\":[\"Join4.Id\"],\"joinType\":\"INNER\"}},\"FORMULA6_copy0\":{\"sources\":[\"FORMULA3_copy0\"],\"action\":\"computeRelative\",\"parameters\":{\"partitionBy\":[\"Join4.Id\"],\"orderBy\":[{\"fieldName\":\"Seq\",\"direction\":\"ASC\"}],\"expressionType\":\"SQL\",\"fields\":[{\"formulaExpression\":\"row_number()\",\"defaultValue\":\"\",\"precision\":10,\"name\":\"dupeCheck\",\"scale\":0,\"label\":\"dupeCheck\",\"type\":\"NUMBER\"}]}},\"JOIN6\":{\"schema\":{\"slice\":{\"mode\":\"DROP\",\"ignoreMissingFields\":true,\"fields\":[]},\"fields\":[]},\"sources\":[\"FILTER0\",\"FORMULA10\"],\"action\":\"join\",\"parameters\":{\"leftKeys\":[\"Join4.CaseId\"],\"rightQualifier\":\"BotCase\",\"rightKeys\":[\"Id\"],\"joinType\":\"LEFT_OUTER\"}},\"JOIN5\":{\"schema\":{\"slice\":{\"mode\":\"DROP\",\"ignoreMissingFields\":true,\"fields\":[\"Join4.ConversationId\"]}},\"sources\":[\"LOAD_DATASET3\",\"LOAD_DATASET0\"],\"action\":\"join\",\"parameters\":{\"leftKeys\":[\"ConversationId\"],\"rightQualifier\":\"Join4\",\"rightKeys\":[\"ConversationId\"],\"joinType\":\"INNER\"}},\"JOIN3\":{\"schema\":{\"slice\":{\"mode\":\"DROP\",\"ignoreMissingFields\":true,\"fields\":[\"User.Id\"]},\"fields\":[]},\"sources\":[\"LOAD_DATASET2\",\"LOAD_DATASET5\"],\"action\":\"join\",\"parameters\":{\"leftKeys\":[\"UserId\"],\"rightQualifier\":\"User\",\"rightKeys\":[\"Id\"],\"joinType\":\"LOOKUP\"}}},\"ui\":{\"hiddenColumns\":[],\"connectors\":[{\"source\":\"AGGREGATE0\",\"target\":\"JOIN1\"},{\"source\":\"JOIN3\",\"target\":\"TRANSFORM0\"},{\"source\":\"TRANSFORM0\",\"target\":\"AGGREGATE0\"},{\"source\":\"FILTER1\",\"target\":\"JOIN1\"},{\"source\":\"LOAD_DATASET2\",\"target\":\"JOIN3\"},{\"source\":\"LOAD_DATASET5\",\"target\":\"JOIN3\"},{\"source\":\"LOAD_DATASET3\",\"target\":\"JOIN5\"},{\"source\":\"JOIN5\",\"target\":\"FILTER0\"},{\"source\":\"UPDATE0\",\"target\":\"OUTPUT0\"},{\"source\":\"JOIN3\",\"target\":\"FILTER2\"},{\"source\":\"FILTER2\",\"target\":\"TRANSFORM2\"},{\"source\":\"TRANSFORM2\",\"target\":\"FILTER3\"},{\"source\":\"JOIN1\",\"target\":\"UPDATE0\"},{\"source\":\"FILTER3\",\"target\":\"UPDATE0\"},{\"source\":\"LOAD_DATASET0\",\"target\":\"JOIN5\"},{\"source\":\"FILTER0\",\"target\":\"JOIN6\"},{\"source\":\"TRANSFORM3\",\"target\":\"JOIN6\"},{\"source\":\"JOIN6\",\"target\":\"TRANSFORM1_copy0\"},{\"source\":\"TRANSFORM1_copy0\",\"target\":\"FILTER1\"},{\"source\":\"LOAD_DATASET6\",\"target\":\"TRANSFORM3\"}],\"nodes\":{\"FILTER0\":{\"top\":112,\"left\":392,\"description\":\"In some cases, a conversation ID is linked to multiple messaging sessions.  This removes entries from \\\"Session 1\\\" that were sent during \\\"Session 2\\\" and vice versa.\",\"label\":\"Remove Duplicate Entries\",\"type\":\"FILTER\"},\"FILTER1\":{\"top\":112,\"left\":812,\"description\":\"\",\"label\":\"1 Row Per Session\",\"type\":\"FILTER\"},\"FILTER2\":{\"top\":252,\"left\":672,\"description\":\"\",\"label\":\"Remove Bot Agentwork\",\"type\":\"FILTER\"},\"TRANSFORM1_copy0\":{\"connectors\":[{\"source\":\"FORMULA2_copy0\",\"target\":\"FORMULA3_copy0\"},{\"source\":\"FORMULA3_copy0\",\"target\":\"FORMULA6_copy0\"},{\"source\":\"FORMULA6_copy0\",\"target\":\"FORMULA8_copy0\"},{\"source\":\"FORMULA8_copy0\",\"target\":\"FORMULA9_copy0\"}],\"top\":112,\"left\":672,\"description\":\"\",\"label\":\"Derive Session Info\",\"type\":\"TRANSFORM\",\"graph\":{\"FORMULA6_copy0\":{\"label\":\"Set Dupecheck Field\"},\"FORMULA9_copy0\":{\"label\":\"Set Bot Results\",\"parameters\":{\"type\":\"BASE_FORMULA_UI\"}},\"FORMULA2_copy0\":{\"label\":\"Agent Reply to User = Engaged\"},\"FORMULA8_copy0\":{\"label\":\"Create Blank Column for Update\",\"parameters\":{\"type\":\"BASE_FORMULA_UI\"}},\"FORMULA3_copy0\":{\"label\":\"Set Session User Interaction\"}}},\"FILTER3\":{\"top\":252,\"left\":952,\"description\":\"\",\"label\":\"Filter Dupes\",\"type\":\"FILTER\"},\"AGGREGATE0\":{\"connectors\":[{\"source\":\"EXTRACT0\",\"target\":\"AGGREGATE1\"}],\"top\":392,\"left\":812,\"description\":\"\",\"label\":\"Aggregate Totals by Session\",\"type\":\"AGGREGATE\",\"graph\":{\"EXTRACT0\":null,\"AGGREGATE1\":null}},\"JOIN1\":{\"top\":112,\"left\":952,\"label\":\"Join 1\",\"type\":\"JOIN\"},\"LOAD_DATASET6\":{\"top\":392,\"left\":252,\"label\":\"Case\",\"type\":\"LOAD_DATASET\",\"parameters\":{\"sampleSize\":2000}},\"LOAD_DATASET5\":{\"top\":532,\"left\":392,\"label\":\"User\",\"type\":\"LOAD_DATASET\",\"parameters\":{\"sampleSize\":2000}},\"OUTPUT0\":{\"top\":112,\"left\":1232,\"label\":\"Output 0\",\"type\":\"OUTPUT\"},\"LOAD_DATASET3\":{\"top\":252,\"left\":112,\"label\":\"ConversationEntry\",\"type\":\"LOAD_DATASET\",\"parameters\":{\"sampleSize\":2000}},\"LOAD_DATASET2\":{\"top\":252,\"left\":392,\"label\":\"AgentWork\",\"type\":\"LOAD_DATASET\",\"parameters\":{\"sampleSize\":2000}},\"UPDATE0\":{\"top\":112,\"left\":1092,\"label\":\"Update 0\",\"type\":\"UPDATE\"},\"LOAD_DATASET0\":{\"top\":112,\"left\":112,\"label\":\"MessagingSession\",\"type\":\"LOAD_DATASET\",\"parameters\":{\"sampleSize\":2000}},\"JOIN6\":{\"top\":112,\"left\":532,\"description\":\"\",\"label\":\"Join With Bot Originated Cases\",\"type\":\"JOIN\"},\"TRANSFORM0\":{\"connectors\":[{\"source\":\"FORMULA0\",\"target\":\"FORMULA1\"},{\"source\":\"FORMULA1\",\"target\":\"FORMULA5\"}],\"top\":392,\"left\":672,\"description\":\"\",\"label\":\"Human Chat Efficiency Calcs\",\"type\":\"TRANSFORM\",\"graph\":{\"FORMULA0\":{\"label\":\"Calc Time in Queue\",\"parameters\":{\"type\":\"BASE_FORMULA_UI\"}},\"FORMULA1\":{\"label\":\"Calc Time to Accept\",\"parameters\":{\"type\":\"BASE_FORMULA_UI\"}},\"FORMULA5\":{\"label\":\"Filter out bot from handle time\",\"parameters\":{\"type\":\"BASE_FORMULA_UI\"}}}},\"JOIN5\":{\"top\":112,\"left\":252,\"description\":\"\",\"label\":\"Link Entries to Session\",\"type\":\"JOIN\"},\"JOIN3\":{\"top\":252,\"left\":532,\"label\":\"Add User Name and Team\",\"type\":\"JOIN\"},\"TRANSFORM2\":{\"connectors\":[],\"top\":252,\"left\":812,\"description\":\"\",\"label\":\"Prepare to Filter Dupes\",\"type\":\"TRANSFORM\",\"graph\":{\"FORMULA7\":{\"label\":\"Formula\"}}},\"TRANSFORM3\":{\"connectors\":[],\"top\":392,\"left\":392,\"description\":\"\",\"label\":\"Prepare Cases\",\"type\":\"TRANSFORM\",\"graph\":{\"FORMULA10\":{\"label\":\"Formula\",\"parameters\":{\"type\":\"BASE_FORMULA_UI\"}}}}}},\"version\":\"64.0\",\"runMode\":\"full\"}"]