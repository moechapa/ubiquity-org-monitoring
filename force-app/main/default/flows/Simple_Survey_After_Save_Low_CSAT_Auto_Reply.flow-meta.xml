<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_5_Star_Follow_Up_Email</name>
        <label>Send 5 Star Follow Up Email</label>
        <locationX>50</locationX>
        <locationY>647</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>support@myubiquity.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailTemplateId</name>
            <value>
                <stringValue>00XUo000002g5jhMAA</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientId</name>
            <value>
                <elementReference>$Record.simplesurvey__Contact__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>relatedRecordId</name>
            <value>
                <elementReference>Copy_2_of_Create_CSAT_Follow_Up_Case</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>logEmailOnSend</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>addThreadingTokenToBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <actionCalls>
        <name>Send_Email_Action_1</name>
        <label>Send Email Action 1</label>
        <locationX>314</locationX>
        <locationY>647</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <faultConnector>
            <targetReference>Update_Case_to_Show_Error</targetReference>
        </faultConnector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>senderType</name>
            <value>
                <stringValue>OrgWideEmailAddress</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>senderAddress</name>
            <value>
                <stringValue>support@myubiquity.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>emailSubj</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>emailBody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>relatedRecordId</name>
            <value>
                <elementReference>Create_CSAT_Follow_Up_Case</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientId</name>
            <value>
                <elementReference>$Record.simplesurvey__Contact__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>logEmailOnSend</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>addThreadingTokenToBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
        <offset>0</offset>
    </actionCalls>
    <apiVersion>61.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <decisions>
        <name>Send_Auto_Reply</name>
        <label>Send Auto Reply?</label>
        <locationX>314</locationX>
        <locationY>323</locationY>
        <defaultConnectorLabel>End</defaultConnectorLabel>
        <rules>
            <name>Don_t_Send</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>tooSoonToSend</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <label>Don&apos;t Send</label>
        </rules>
        <rules>
            <name>Send_5_Star_CSAT_Auto_Reply</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>tooSoonToSend</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.simplesurvey__Survey_Score__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <numberValue>5.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Copy_2_of_Update_Auto_Reply_Date_on_Contact</targetReference>
            </connector>
            <label>Send 5 Star CSAT Auto Reply</label>
        </rules>
        <rules>
            <name>Send_Low_CSAT_Reply</name>
            <conditionLogic>1 AND (2 OR 3 OR 4)</conditionLogic>
            <conditions>
                <leftValueReference>tooSoonToSend</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.simplesurvey__Case__r.Sender_Role__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Sponsor</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.simplesurvey__Case__r.Sender_Role__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Advisor</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.simplesurvey__Case__r.Sender_Role__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>TPA</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Auto_Reply_Date_on_Contact</targetReference>
            </connector>
            <label>Send Low CSAT Reply</label>
        </rules>
    </decisions>
    <description>Updated email template used for 5 star reply</description>
    <environments>Default</environments>
    <formulas>
        <name>tooSoonToSend</name>
        <dataType>Boolean</dataType>
        <expression>IF( TODAY() - {!$Record.simplesurvey__Contact__r.Last_CSAT_Reply__c} &lt; 30, TRUE, FALSE)</expression>
    </formulas>
    <interviewLabel>Simple Survey | After Save | Low CSAT Auto Reply {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Simple Survey | After Save | CSAT Auto Reply</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Copy_2_of_Create_CSAT_Follow_Up_Case</name>
        <label>Copy 2 of Create CSAT Follow Up Case</label>
        <locationX>50</locationX>
        <locationY>539</locationY>
        <connector>
            <targetReference>Send_5_Star_Follow_Up_Email</targetReference>
        </connector>
        <inputAssignments>
            <field>AccountId</field>
            <value>
                <elementReference>$Record.simplesurvey__Case__r.AccountId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ContactId</field>
            <value>
                <elementReference>$Record.simplesurvey__Contact__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>fiveStarDesc</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <stringValue>00GUo000001wPtV</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Plan__c</field>
            <value>
                <elementReference>$Record.simplesurvey__Case__r.Plan__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Sender_Role__c</field>
            <value>
                <elementReference>$Record.simplesurvey__Case__r.Sender_Role__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Resolved</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>fiveStarSubj</elementReference>
            </value>
        </inputAssignments>
        <object>Case</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Create_CSAT_Follow_Up_Case</name>
        <label>Create CSAT Follow Up Case</label>
        <locationX>314</locationX>
        <locationY>539</locationY>
        <connector>
            <targetReference>Send_Email_Action_1</targetReference>
        </connector>
        <inputAssignments>
            <field>AccountId</field>
            <value>
                <elementReference>$Record.simplesurvey__Case__r.AccountId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ContactId</field>
            <value>
                <elementReference>$Record.simplesurvey__Contact__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>caseDesc</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <stringValue>00GUo000001wPtV</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Plan__c</field>
            <value>
                <elementReference>$Record.simplesurvey__Case__r.Plan__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Sender_Role__c</field>
            <value>
                <elementReference>$Record.simplesurvey__Case__r.Sender_Role__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Resolved</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>caseSubj</elementReference>
            </value>
        </inputAssignments>
        <object>Case</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordUpdates>
        <name>Copy_2_of_Update_Auto_Reply_Date_on_Contact</name>
        <label>Copy 2 of Update Auto Reply Date on Contact</label>
        <locationX>50</locationX>
        <locationY>431</locationY>
        <connector>
            <targetReference>Copy_2_of_Create_CSAT_Follow_Up_Case</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.simplesurvey__Contact__r.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Last_CSAT_Reply__c</field>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </inputAssignments>
        <object>Contact</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Auto_Reply_Date_on_Contact</name>
        <label>Update Auto Reply Date on Contact</label>
        <locationX>314</locationX>
        <locationY>431</locationY>
        <connector>
            <targetReference>Create_CSAT_Follow_Up_Case</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.simplesurvey__Contact__r.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Last_CSAT_Reply__c</field>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </inputAssignments>
        <object>Contact</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Case_to_Show_Error</name>
        <label>Update Case to Show Error</label>
        <locationX>578</locationX>
        <locationY>755</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Create_CSAT_Follow_Up_Case</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>errorCaseDesc</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>New</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>errorCaseSubj</elementReference>
            </value>
        </inputAssignments>
        <object>Case</object>
    </recordUpdates>
    <start>
        <locationX>188</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Send_Auto_Reply</targetReference>
        </connector>
        <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
        <filterLogic>1 AND 2 AND 3 AND 7 AND (4 OR 5 OR 6)</filterLogic>
        <filters>
            <field>simplesurvey__Contact__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>simplesurvey__Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </filters>
        <filters>
            <field>simplesurvey__Survey_Score__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <numberValue>4.0</numberValue>
            </value>
        </filters>
        <filters>
            <field>Team__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Saver</stringValue>
            </value>
        </filters>
        <filters>
            <field>Team__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>CST</stringValue>
            </value>
        </filters>
        <filters>
            <field>Team__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>SingleK</stringValue>
            </value>
        </filters>
        <filters>
            <field>simplesurvey__Survey_Score__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <object>simplesurvey__Survey__c</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>caseDesc</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>A Low CSAT Auto Reply was sent to this contact on {!$Flow.CurrentDate}</text>
    </textTemplates>
    <textTemplates>
        <name>caseSubj</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Low CSAT Outreach</text>
    </textTemplates>
    <textTemplates>
        <name>emailBody</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Dear {!$Record.simplesurvey__Contact__r.FirstName},

Thank you for taking the time to provide feedback on your recent experience with us. We noticed that your recent CSAT/NPS score was lower than we aim for, and we sincerely apologize for any inconvenience this may have caused.

Your satisfaction is our top priority, and we are committed to improving our services. To better understand what went wrong and how we can make things right, we would greatly appreciate any additional details you can provide about your experience.

Could you please take a moment to share more specific feedback? Here are a few questions to guide you:

1. What specific issue(s) led to your dissatisfaction?
2. Were there any interactions or aspects of our service that did not meet your expectations?
3. How can we improve to better meet your needs in the future?

We are committed to learning from your experience and making any necessary improvements. Your insights are invaluable in helping us enhance our service for you and other customers.

Please reply directly to this email with your feedback. We genuinely appreciate your time and input.

Thank you for helping us improve.

Best Regards</text>
    </textTemplates>
    <textTemplates>
        <name>emailSubj</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Help Us Improve: Follow-Up on Your Survey Feedback</text>
    </textTemplates>
    <textTemplates>
        <name>errorCaseDesc</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>There was an error with the CSAT Auto Reply, please send the CSAT email template manually through this case.</text>
    </textTemplates>
    <textTemplates>
        <name>errorCaseSubj</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Error Sending CSAT Auto Reply</text>
    </textTemplates>
    <textTemplates>
        <name>fiveStarDesc</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>A 5 star CSAT Auto Reply was sent to this contact on {!$Flow.CurrentDate}</text>
    </textTemplates>
    <textTemplates>
        <name>fiveStarSubj</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>5 Star CSAT Outreach</text>
    </textTemplates>
</Flow>
