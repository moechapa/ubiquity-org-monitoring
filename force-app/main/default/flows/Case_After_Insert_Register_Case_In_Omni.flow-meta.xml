<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>64.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <decisions>
        <description>Is the running user (created and owns the case) an omni case user?</description>
        <name>Check_If_Omni_Case_User</name>
        <label>Check If Omni Case User</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Is_Omni_Case_User</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Permission_Asisgnment</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Case_Service_Channel_Id</targetReference>
            </connector>
            <label>Is Omni Case User</label>
        </rules>
    </decisions>
    <description>Creates pending omni routing for cases manually created by omni case user.</description>
    <environments>Default</environments>
    <interviewLabel>Case | After Insert | Register Case In Omni {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case | After Insert | Register Case In Omni</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Pending_Routing</name>
        <label>Create Pending Routing</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <inputAssignments>
            <field>CapacityPercentage</field>
            <value>
                <elementReference>Get_Default_Routing_Configuration.CapacityPercentage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>CapacityWeight</field>
            <value>
                <elementReference>Get_Default_Routing_Configuration.CapacityWeight</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>IsInterruptible</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>IsPreferredUserRequired</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>PausedCapacityPercentage</field>
            <value>
                <elementReference>Get_Default_Routing_Configuration.PausedCapacityPercentage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>PausedCapacityWeight</field>
            <value>
                <elementReference>Get_Default_Routing_Configuration.PausedCapacityWeight</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>PreferredUserId</field>
            <value>
                <elementReference>$User.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RoutingPriority</field>
            <value>
                <elementReference>Get_Default_Routing_Configuration.RoutingPriority</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RoutingType</field>
            <value>
                <stringValue>SkillsBased</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ServiceChannelId</field>
            <value>
                <elementReference>Get_Case_Service_Channel_Id.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>WorkItemId</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <object>PendingServiceRouting</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordLookups>
        <name>Get_Case_Service_Channel_Id</name>
        <label>Get Case Service Channel Id</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Default_Routing_Configuration</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>RelatedEntity</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Case</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>ServiceChannel</object>
        <queriedFields>Id</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Default_Routing_Configuration</name>
        <label>Get Default Routing Configuration</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Create_Pending_Routing</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>General_Case</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>QueueRoutingConfig</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>CapacityPercentage</queriedFields>
        <queriedFields>CapacityWeight</queriedFields>
        <queriedFields>PausedCapacityPercentage</queriedFields>
        <queriedFields>PausedCapacityWeight</queriedFields>
        <queriedFields>RoutingPriority</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Omni_Case_Permission_Set</name>
        <label>Get Omni Case Permission Set</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Permission_Asisgnment</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Name</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Omni_Channel_Case_User</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>PermissionSet</object>
        <queriedFields>Id</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Permission_Asisgnment</name>
        <label>Get Permission Asisgnment</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_If_Omni_Case_User</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>AssigneeId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$User.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>PermissionSetId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Omni_Case_Permission_Set.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>PermissionSetAssignment</object>
        <queriedFields>Id</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Omni_Case_Permission_Set</targetReference>
        </connector>
        <filterFormula>{!$Record.CreatedById} = {!$Record.OwnerId} &amp;&amp; NOT(ISPICKVAL({!$Record.Status},&apos;Resolved&apos;))</filterFormula>
        <object>Case</object>
        <recordTriggerType>Create</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
</Flow>
