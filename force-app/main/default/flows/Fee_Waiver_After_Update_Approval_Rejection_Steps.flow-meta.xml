<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Approved_Chatter_Message</name>
        <label>Approved Chatter Message</label>
        <locationX>50</locationX>
        <locationY>539</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <elementReference>approvedChatter</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>$Record.Case__c</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <offset>0</offset>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <actionCalls>
        <name>Send_Chatter_to_Alert_of_Rejection</name>
        <label>Send Chatter to Alert of Rejection</label>
        <locationX>314</locationX>
        <locationY>431</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <elementReference>rejectionChatter</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>$Record.Case__c</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <offset>0</offset>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <apiVersion>61.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <decisions>
        <name>Approved_or_Denied</name>
        <label>Approved or Denied?</label>
        <locationX>182</locationX>
        <locationY>323</locationY>
        <defaultConnector>
            <targetReference>Send_Chatter_to_Alert_of_Rejection</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Denied</defaultConnectorLabel>
        <rules>
            <name>Approved</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Fee_Waiver_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Approval Granted</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Case_for_A_F</targetReference>
            </connector>
            <label>Approved</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <name>linkToRecord</name>
        <dataType>String</dataType>
        <expression>LEFT($Api.Partner_Server_URL_260, FIND( &apos;/services&apos;, $Api.Partner_Server_URL_260)) &amp; {!$Record.Id}</expression>
    </formulas>
    <interviewLabel>Fee Waiver | After Update | Approval/Rejection Steps {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Fee Waiver | After Update | Approval/Rejection Steps</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Case_for_A_F</name>
        <label>Create Case for A&amp;F</label>
        <locationX>50</locationX>
        <locationY>431</locationY>
        <connector>
            <targetReference>Approved_Chatter_Message</targetReference>
        </connector>
        <inputAssignments>
            <field>AccountId</field>
            <value>
                <elementReference>$Record.Account__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Category__c</field>
            <value>
                <stringValue>Billing, Commissions, and Fees</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Department__c</field>
            <value>
                <stringValue>Accounting &amp; Finance</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>afDesc</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <stringValue>00500000006yEak</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ParentId</field>
            <value>
                <elementReference>$Record.Case__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Plan__c</field>
            <value>
                <elementReference>$Record.Case__r.Plan__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Sender_Role__c</field>
            <value>
                <stringValue>Sponsor</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Sub_Category__c</field>
            <value>
                <stringValue>Refund or Waive Request</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <elementReference>afSubj</elementReference>
            </value>
        </inputAssignments>
        <object>Case</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <start>
        <locationX>56</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Approved_or_Denied</targetReference>
        </connector>
        <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
        <filterLogic>or</filterLogic>
        <filters>
            <field>Fee_Waiver_Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Approval Granted</stringValue>
            </value>
        </filters>
        <filters>
            <field>Fee_Waiver_Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Approval Denied</stringValue>
            </value>
        </filters>
        <object>Fee_Waiver__c</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>afDesc</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Hello, a ${!$Record.Amount__c} Fee Waiver Request for {!$Record.Account__r.Name} has been approved. Please create a fee waiver for the client and close this case when the waiver has been applied. Thank you!
Link to Record: {!linkToRecord}
Amount: ${!$Record.Amount__c}
Reason: {!$Record.Reason_for_Fee_Waiver__c}
Type: {!$Record.Refund_Type__c}</text>
    </textTemplates>
    <textTemplates>
        <name>afSubj</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Approved Fee Waiver Request for {!$Record.Account__r.Name}</text>
    </textTemplates>
    <textTemplates>
        <name>approvedChatter</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Fee waiver approved, child case was created for A&amp;F.</text>
    </textTemplates>
    <textTemplates>
        <name>rejectionChatter</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Hello, the ${!$Record.Amount__c} fee waiver request for {!$Record.Account__r.Name} has been denied. Please let the requestor know we will not be processing a fee waiver for them.</text>
    </textTemplates>
</Flow>
