<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>53.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Add_companions_to_prods2add</name>
        <label>Add companions to products2add</label>
        <locationX>525</locationX>
        <locationY>458</locationY>
        <assignmentItems>
            <assignToReference>products2Add</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Companion_Loop</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Companion_Loop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Core_to_Collection</name>
        <label>Add Core to Collection</label>
        <locationX>973</locationX>
        <locationY>1454</locationY>
        <assignmentItems>
            <assignToReference>products2Add</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>newCoreProduct</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>product_code_check</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Final_Code</name>
        <label>Add Final Code</label>
        <locationX>1360</locationX>
        <locationY>1314</locationY>
        <assignmentItems>
            <assignToReference>coreCodeCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>prodCodeVariable</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Companion_Product_Check</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Leftmost_Code_to_coll</name>
        <label>Add Leftmost Code to coll</label>
        <locationX>1373</locationX>
        <locationY>1816</locationY>
        <assignmentItems>
            <assignToReference>coreCodeCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>isolatedLeftmostCode</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>removeLeftmostCode</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Line_Item</name>
        <label>Add Line Item</label>
        <locationX>1608</locationX>
        <locationY>68</locationY>
        <assignmentItems>
            <assignToReference>oppLineItemCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>oppLineItem</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Define_Opp_Products</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_product_to_error_list</name>
        <label>Add product to error list</label>
        <locationX>1230</locationX>
        <locationY>505</locationY>
        <assignmentItems>
            <assignToReference>productErrorList</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Define_Opp_Products.Name</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>productErrorList</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>&quot;, &quot;</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Define_Opp_Products</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_to_product_id_collection</name>
        <label>Add to product id collection</label>
        <locationX>723</locationX>
        <locationY>720</locationY>
        <assignmentItems>
            <assignToReference>productIdCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Product_to_ProductId_Loop.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Product_to_ProductId_Loop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_to_product_id_collection_0</name>
        <label>Add to product id collection</label>
        <locationX>943</locationX>
        <locationY>751</locationY>
        <assignmentItems>
            <assignToReference>productIdCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>pricebookEntryIDloop.Product2Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>pricebookEntryIDloop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Upgrade_Items</name>
        <label>Add Upgrade Items</label>
        <locationX>1671</locationX>
        <locationY>1215</locationY>
        <assignmentItems>
            <assignToReference>oppLineItemCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>oppUpgradeLineItem</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>oppLineItemCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>oppUpgradePrevLineItem</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Companion_Product_Check</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Opp_Update_Notes</name>
        <label>Assign Opp Update Notes</label>
        <locationX>2254</locationX>
        <locationY>1103</locationY>
        <assignmentItems>
            <assignToReference>$Record.Opportunity_Notes__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>productErrorMessage</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Opp_Needs_Update_Check</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Opp_Update_Pricebook</name>
        <label>Assign Opp Update Pricebook</label>
        <locationX>2007</locationX>
        <locationY>1088</locationY>
        <assignmentItems>
            <assignToReference>$Record.Pricebook2Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>priceBookId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>OppNotes_Update_Check</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Opp_Update_Resetbox</name>
        <label>Assign Opp Update Resetbox</label>
        <locationX>1793</locationX>
        <locationY>1083</locationY>
        <assignmentItems>
            <assignToReference>$Record.Reset_Products__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Pricebook_Update_Check</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Define_Code_Variable</name>
        <label>Define Code Variable</label>
        <locationX>1129</locationX>
        <locationY>1602</locationY>
        <assignmentItems>
            <assignToReference>prodCodeVariable</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>newCoreProduct.ProductCode</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>What_does_code_need_done</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Define_Line_Item</name>
        <label>Define Line Item</label>
        <locationX>1374</locationX>
        <locationY>50</locationY>
        <assignmentItems>
            <assignToReference>oppLineItem.Product2Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Define_Opp_Products.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>oppLineItem.OpportunityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>oppLineItem.Discount_Percentage__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Discount</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>oppLineItem.Discount_Amount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>DiscountAmount</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Add_Line_Item</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Define_Upgrade_Line_Items</name>
        <label>Define Upgrade Line Items</label>
        <locationX>1692</locationX>
        <locationY>1988</locationY>
        <assignmentItems>
            <assignToReference>oppUpgradeLineItem.Product2Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>UpgradePBentry.Product2Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>oppUpgradeLineItem.OpportunityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>oppUpgradeLineItem.Description</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>New Service Option</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>oppUpgradePrevLineItem.Product2Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>prevUpgradePBentry.Product2Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>oppUpgradePrevLineItem.OpportunityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>oppUpgradePrevLineItem.Description</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Previous Service Option</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>oppUpgradePrevLineItem.Discount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>prevDiscount</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>oppUpgradeLineItem.Discount__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <connector>
            <targetReference>Add_Upgrade_Items</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>purge_product_ids</name>
        <label>purge product ids</label>
        <locationX>1220</locationX>
        <locationY>985</locationY>
        <assignmentItems>
            <assignToReference>productIdCollection</assignToReference>
            <operator>RemoveAll</operator>
            <value>
                <elementReference>productIdCollection</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>pricebookEntryIDloop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Referral_Discount_0</name>
        <label>Referral Discount</label>
        <locationX>931</locationX>
        <locationY>361</locationY>
        <assignmentItems>
            <assignToReference>Discount</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>100.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>is_this_in_the_chosen_pricebook</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Referral_Discount_Amount_0</name>
        <label>Referral Discount Amount</label>
        <locationX>826</locationX>
        <locationY>527</locationY>
        <assignmentItems>
            <assignToReference>DiscountAmount</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>300.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>is_this_in_the_chosen_pricebook</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>removeLeftmostCode</name>
        <label>removeLeftmostCode</label>
        <locationX>1600</locationX>
        <locationY>1817</locationY>
        <assignmentItems>
            <assignToReference>prodCodeVariable</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>removedLeftmostCode</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>What_does_code_need_done</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Wipe_Discounts_Add_Collection</name>
        <label>Wipe Discounts + Add Collection</label>
        <locationX>1150</locationX>
        <locationY>690</locationY>
        <assignmentItems>
            <assignToReference>Discount</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>DiscountAmount</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <connector>
            <targetReference>Discount_Check</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>Does this have product code(s)</description>
        <name>Companion_Product_Check</name>
        <label>Companion Product Check</label>
        <locationX>835</locationX>
        <locationY>1092</locationY>
        <defaultConnector>
            <targetReference>Product_to_ProductId_Loop</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Companion_Needed</name>
            <conditionLogic>(1 AND 2) OR (3 AND 4)</conditionLogic>
            <conditions>
                <leftValueReference>newCoreProduct.ProductCode</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Upgrade</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Upgrade</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>newCompQualified</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Grab_Potential_Companions</targetReference>
            </connector>
            <label>Companion Needed</label>
        </rules>
    </decisions>
    <decisions>
        <name>Discount_Check</name>
        <label>Discount Check</label>
        <locationX>1027</locationX>
        <locationY>572</locationY>
        <defaultConnector>
            <targetReference>is_this_in_the_chosen_pricebook</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesReferral_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.LeadSource</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Referral</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Define_Opp_Products.Family</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Setup</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Owner.UserRoleId</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>00E00000006xFiWEAU</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Referral_Discount_0</targetReference>
            </connector>
            <label>Yes Referral</label>
        </rules>
        <rules>
            <name>Yes_ProBeauty_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.LeadSourceDetail__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>ProBeauty</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Define_Opp_Products.Family</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Setup</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Referral_Discount_0</targetReference>
            </connector>
            <label>Yes ProBeauty</label>
        </rules>
        <rules>
            <name>Yes_PSIVet_0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.LeadSourceDetail__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>PSIvet</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Define_Opp_Products.Family</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>401(k)</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Referral_Discount_Amount_0</targetReference>
            </connector>
            <label>Yes PSIVet</label>
        </rules>
    </decisions>
    <decisions>
        <name>Entry_Validation</name>
        <label>Entry Validation</label>
        <locationX>213</locationX>
        <locationY>1123</locationY>
        <defaultConnectorLabel>Abort</defaultConnectorLabel>
        <rules>
            <name>Proceed</name>
            <conditionLogic>(((1 OR (2 AND 3)) AND (5 OR (6 AND 7))) OR 4 OR (5 AND 8)) OR 9</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Service_Option__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Profit_Sharing__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>New Comparability</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.Profit_Sharing__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>New Comparability</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>isNew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.IsClosed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Pricebook2.IsActive</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.IsClosed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Pricebook2.IsActive</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Reset_Products__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Is_Price_Book_Already_Set</targetReference>
            </connector>
            <label>Proceed</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_Price_Book_Already_Set</name>
        <label>Is Price Book Already Set?</label>
        <locationX>50</locationX>
        <locationY>1191</locationY>
        <defaultConnector>
            <targetReference>Price_Book</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesPriceBookExists</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Pricebook2Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Products_0</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>is_this_in_the_chosen_pricebook</name>
        <label>is this in the chosen pricebook</label>
        <locationX>1124</locationX>
        <locationY>319</locationY>
        <defaultConnector>
            <targetReference>Add_product_to_error_list</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Product_Present_in_pricebook</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>productIdCollection</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Define_Opp_Products.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Define_Line_Item</targetReference>
            </connector>
            <label>Product Present in pricebook</label>
        </rules>
    </decisions>
    <decisions>
        <name>Opp_Needs_Update_Check</name>
        <label>Opp Needs Update Check</label>
        <locationX>2391</locationX>
        <locationY>912</locationY>
        <defaultConnector>
            <targetReference>Create_Opportunity_Line_Items</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Opp_Needs_Update</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>Needs_Note_Update</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Needs_Pricebook_Update</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Needs_Resetbox_Update</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Triggering_Opp</targetReference>
            </connector>
            <label>Opp Needs Update</label>
        </rules>
    </decisions>
    <decisions>
        <description>Used for when products are missing</description>
        <name>OppNotes_Update_Check</name>
        <label>OppNotes Update Check</label>
        <locationX>2108</locationX>
        <locationY>912</locationY>
        <defaultConnector>
            <targetReference>Opp_Needs_Update_Check</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Needs_Note_Update</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>productErrorList</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Opp_Update_Notes</targetReference>
            </connector>
            <label>Needs Note Update</label>
        </rules>
    </decisions>
    <decisions>
        <name>Price_Book</name>
        <label>Price Book</label>
        <locationX>256</locationX>
        <locationY>1330</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Add_On</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Product_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>PLACEHOLDER FOR FUTURE STATE</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Product_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>PLACEHOLDER FOR FUTURE STATE</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Add_On_PB</targetReference>
            </connector>
            <label>Add-On</label>
        </rules>
        <rules>
            <name>Upgrade</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Product_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Upgrade</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Upgrade_PB</targetReference>
            </connector>
            <label>Upgrade</label>
        </rules>
        <rules>
            <name>Single_k</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Product_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Single(k)</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Single_k_PB</targetReference>
            </connector>
            <label>Single(k)</label>
        </rules>
        <rules>
            <name>JPM</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.LeadSourceDetail__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>JPM</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_JPM_PB</targetReference>
            </connector>
            <label>JPM</label>
        </rules>
        <rules>
            <name>RewardJet</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.LeadSourceDetail__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>RewardJet</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_RewardJet_PB</targetReference>
            </connector>
            <label>RewardJet</label>
        </rules>
        <rules>
            <name>Rippling</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.LeadSourceDetail__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Rippling</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Rippling_PB</targetReference>
            </connector>
            <label>Rippling</label>
        </rules>
        <rules>
            <name>X401_K</name>
            <conditionLogic>1 AND NOT 2</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Product_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>401(k)</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Service_Option__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>Simply Retirement</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_401_k_PB</targetReference>
            </connector>
            <label>401(K)</label>
        </rules>
        <rules>
            <name>Simply_Retirement</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Service_Option__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Simply Retirement Bundled</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Service_Option__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Simply Retirement Unbundled</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Simply_PB</targetReference>
            </connector>
            <label>Simply Retirement</label>
        </rules>
        <rules>
            <name>Sallus</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Service_Option__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Starter</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Service_Option__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Franchise</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Service_Option__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Builder</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Service_Option__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Partner</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Sallus_PB</targetReference>
            </connector>
            <label>Sallus</label>
        </rules>
    </decisions>
    <decisions>
        <name>Pricebook_Update_Check</name>
        <label>Pricebook Update Check</label>
        <locationX>1895</locationX>
        <locationY>908</locationY>
        <defaultConnector>
            <targetReference>OppNotes_Update_Check</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Needs_Pricebook_Update</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>PBneedsUpdate</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Opp_Update_Pricebook</targetReference>
            </connector>
            <label>Needs Pricebook Update</label>
        </rules>
    </decisions>
    <decisions>
        <name>product_code_check</name>
        <label>product code check</label>
        <locationX>1120</locationX>
        <locationY>1399</locationY>
        <defaultConnectorLabel>no product</defaultConnectorLabel>
        <rules>
            <name>Product_Code_Found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>newCoreProduct.ProductCode</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Define_Code_Variable</targetReference>
            </connector>
            <label>Product Code Found</label>
        </rules>
        <rules>
            <name>Product_Found_no_code</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>newCoreProduct.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Companion_Product_Check</targetReference>
            </connector>
            <label>Product Found no code</label>
        </rules>
    </decisions>
    <decisions>
        <name>Replacement_Check_Needed</name>
        <label>Replacement Check Needed</label>
        <locationX>1464</locationX>
        <locationY>1000</locationY>
        <defaultConnector>
            <targetReference>ResetBox_Update_Check</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Fresh Opp</defaultConnectorLabel>
        <rules>
            <name>Opp_Has_Products</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ProductsToDelete</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Delete_Old_Prods</targetReference>
            </connector>
            <label>Opp Has Products</label>
        </rules>
    </decisions>
    <decisions>
        <name>ResetBox_Update_Check</name>
        <label>ResetBox Update Check</label>
        <locationX>1697</locationX>
        <locationY>907</locationY>
        <defaultConnector>
            <targetReference>Pricebook_Update_Check</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Needs_Resetbox_Update</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Reset_Products__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Opp_Update_Resetbox</targetReference>
            </connector>
            <label>Needs Resetbox Update</label>
        </rules>
    </decisions>
    <decisions>
        <name>Upgrade_Products_Found_Check</name>
        <label>Upgrade Products Found Check</label>
        <locationX>1162</locationX>
        <locationY>2004</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>New_and_Prev_products_found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>UpgradePBentry.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>prevUpgradePBentry.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Define_Upgrade_Line_Items</targetReference>
            </connector>
            <label>New and Prev products found</label>
        </rules>
    </decisions>
    <decisions>
        <name>Verify_Companion_Need</name>
        <label>Verify Companion Need</label>
        <locationX>210</locationX>
        <locationY>464</locationY>
        <defaultConnector>
            <targetReference>Add_companions_to_prods2add</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Not_Needed_Catch</name>
            <conditionLogic>(1 and (4 OR 5)) or (2 and 3)</conditionLogic>
            <conditions>
                <leftValueReference>Companion_Loop.Family</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Conversion</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Profit_Sharing__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>New Comparability</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Companion_Loop.Family</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>New Comp</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Plan_Type__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>Conversion Plan</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Product_Type__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <stringValue>401(k)</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Companion_Loop</targetReference>
            </connector>
            <label>Not Needed Catch</label>
        </rules>
    </decisions>
    <decisions>
        <name>Verify_PB_Found</name>
        <label>Verify PB Found</label>
        <locationX>658</locationX>
        <locationY>1384</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>PB_Valid_Upgrade</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Upgrade</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Grab_Upgrade_Product</targetReference>
            </connector>
            <label>PB Valid Upgrade</label>
        </rules>
        <rules>
            <name>PB_Valid_Need_Product</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>priceBookId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Relevant_Products</targetReference>
            </connector>
            <label>PB Valid Need Product</label>
        </rules>
    </decisions>
    <decisions>
        <description>is there one or more left?  any left?</description>
        <name>What_does_code_need_done</name>
        <label>What does code need done</label>
        <locationX>1488</locationX>
        <locationY>1552</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>More_than_one_code_remains</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>prodCodeVariable</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>,</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Add_Leftmost_Code_to_coll</targetReference>
            </connector>
            <label>More than one code remains</label>
        </rules>
        <rules>
            <name>Last_Code</name>
            <conditionLogic>NOT 1</conditionLogic>
            <conditions>
                <leftValueReference>prodCodeVariable</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>,</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Add_Final_Code</targetReference>
            </connector>
            <label>Last Code</label>
        </rules>
    </decisions>
    <description>Updated so that the reset box is properly toggled &quot;off&quot; when used to trigger flow</description>
    <environments>Default</environments>
    <formulas>
        <name>codeCommaFinder</name>
        <dataType>Number</dataType>
        <expression>FIND(&quot;,&quot;, {!prodCodeVariable})</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <name>employeeCount</name>
        <dataType>String</dataType>
        <expression>IF(CONTAINS(TEXT({!$Record.Service_Option__c}),&quot;Single(k)&quot;),
CASE({!$Record.Number_of_Employees__c},
1,&quot;1&quot;,
2,&quot;2&quot;,
3,&quot;3&quot;,
4,&quot;4&quot;,&quot;error&quot;),
IF(CONTAINS(TEXT({!$Record.Service_Option__c}),&quot;Starter&quot;)||
CONTAINS(TEXT({!$Record.Service_Option__c}),&quot;Builder&quot;)||
CONTAINS(TEXT({!$Record.Service_Option__c}),&quot;Franchise&quot;)||
CONTAINS(TEXT({!$Record.Service_Option__c}),&quot;Partner&quot;),&quot;&quot;,
IF(ISPICKVAL({!$Record.Service_Option__c},&quot;Simply Retirement Unbundled&quot;), &quot;1+&quot;,
IF(ISPICKVAL({!$Record.Service_Option__c},&quot;Simply Retirement Bundled&quot;), &quot;1+&quot;,
IF({!$Record.Number_of_Employees__c} &lt;= 15, &quot;2-15&quot;,
IF({!$Record.Number_of_Employees__c} &lt;= 30, &quot;16-30&quot;,
IF({!$Record.Number_of_Employees__c}&lt;= 50, &quot;31-50&quot;,
IF({!$Record.Number_of_Employees__c} &lt;= 75, &quot;51-75&quot;,
IF({!$Record.Number_of_Employees__c} &lt;= 100, &quot;76-100&quot;,
&quot;101+&quot;)))))))))</expression>
    </formulas>
    <formulas>
        <name>employeeCountPrev</name>
        <dataType>String</dataType>
        <expression>IF(CONTAINS(TEXT({!$Record.Previous_Service_Option__c}),&quot;Single(k)&quot;),
CASE({!$Record.Number_of_Employees__c},
1,&quot;1&quot;,
2,&quot;2&quot;,
3,&quot;3&quot;,
4,&quot;4&quot;,&quot;error&quot;),
IF(CONTAINS(TEXT({!$Record.Previous_Service_Option__c}),&quot;Starter&quot;)||
CONTAINS(TEXT({!$Record.Previous_Service_Option__c}),&quot;Builder&quot;)||
CONTAINS(TEXT({!$Record.Previous_Service_Option__c}),&quot;Franchise&quot;)||
CONTAINS(TEXT({!$Record.Previous_Service_Option__c}),&quot;Partner&quot;),&quot;&quot;,
IF(ISPICKVAL({!$Record.Previous_Service_Option__c},&quot;Simply Retirement Unbundled&quot;), &quot;1+&quot;,
IF(ISPICKVAL({!$Record.Previous_Service_Option__c},&quot;Simply Retirement Bundled&quot;), &quot;1+&quot;,
IF({!$Record.Number_of_Employees__c} &lt;= 15, &quot;2-15&quot;,
IF({!$Record.Number_of_Employees__c} &lt;= 30, &quot;16-30&quot;,
IF({!$Record.Number_of_Employees__c}&lt;= 50, &quot;31-50&quot;,
IF({!$Record.Number_of_Employees__c} &lt;= 75, &quot;51-75&quot;,
IF({!$Record.Number_of_Employees__c} &lt;= 100, &quot;76-100&quot;,
&quot;101+&quot;)))))))))</expression>
    </formulas>
    <formulas>
        <name>formattedPrevServiceOption</name>
        <dataType>String</dataType>
        <expression>IF(TEXT({!$Record.Previous_Service_Option__c})=&quot;Simply Retirement Unbundled&quot;, &quot;Simply TPA&quot;,
IF(TEXT({!$Record.Previous_Service_Option__c})=&quot;Simply Retirement Bundled&quot;, &quot;Simply |&quot;,
TEXT({!$Record.Previous_Service_Option__c})
))</expression>
    </formulas>
    <formulas>
        <name>formattedServiceOption</name>
        <dataType>String</dataType>
        <expression>IF(TEXT({!$Record.Service_Option__c})=&quot;Simply Retirement Unbundled&quot;, &quot;Simply TPA&quot;,
IF(TEXT({!$Record.Service_Option__c})=&quot;Simply Retirement Bundled&quot;, &quot;Simply |&quot;,
TEXT({!$Record.Service_Option__c})))</expression>
    </formulas>
    <formulas>
        <name>isNew</name>
        <dataType>Boolean</dataType>
        <expression>ISNEW()</expression>
    </formulas>
    <formulas>
        <name>isolatedLeftmostCode</name>
        <dataType>String</dataType>
        <expression>LEFT({!prodCodeVariable},{!codeCommaFinder}-1)</expression>
    </formulas>
    <formulas>
        <description>Qualifies for new comp product(s)</description>
        <name>newCompQualified</name>
        <dataType>Boolean</dataType>
        <expression>ISPICKVAL({!$Record.Profit_Sharing__c},&quot;New Comparability&quot;) &amp;&amp;
(ISPICKVAL({!$Record.Service_Option__c},&quot;Saver(k)&quot;) ||
ISPICKVAL({!$Record.Service_Option__c},&quot;Custom(k)&quot;) ||
ISPICKVAL({!$Record.Service_Option__c},&quot;Simply Retirement Bundled&quot;))</expression>
    </formulas>
    <formulas>
        <name>PBneedsUpdate</name>
        <dataType>Boolean</dataType>
        <expression>{!$Record.Pricebook2Id}&lt;&gt;{!priceBookId}</expression>
    </formulas>
    <formulas>
        <name>prevDiscount</name>
        <dataType>Number</dataType>
        <expression>{!prevUpgradePBentry.UnitPrice} * 2</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>removedLeftmostCode</name>
        <dataType>String</dataType>
        <expression>RIGHT({!prodCodeVariable},LEN({!prodCodeVariable})-{!codeCommaFinder})</expression>
    </formulas>
    <interviewLabel>Opportunity | After Trigger | Add/Edit Products {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Opportunity | After Trigger | Add/Edit Products</label>
    <loops>
        <name>Companion_Loop</name>
        <label>Companion Loop</label>
        <locationX>541</locationX>
        <locationY>614</locationY>
        <collectionReference>potentialCompanionProducts</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Verify_Companion_Need</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Product_to_ProductId_Loop</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Define_Opp_Products</name>
        <label>Define Opp Products</label>
        <locationX>1352</locationX>
        <locationY>792</locationY>
        <collectionReference>products2Add</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Wipe_Discounts_Add_Collection</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Replacement_Check_Needed</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <description>grabbing product IDs from pricebook entries for filtering</description>
        <name>pricebookEntryIDloop</name>
        <label>pricebookEntryIDloop</label>
        <locationX>1148</locationX>
        <locationY>856</locationY>
        <collectionReference>Grab_Pricebook_Entries</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_to_product_id_collection_0</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Define_Opp_Products</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Product_to_ProductId_Loop</name>
        <label>Product to ProductId Loop</label>
        <locationX>824</locationX>
        <locationY>885</locationY>
        <collectionReference>products2Add</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_to_product_id_collection</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Grab_Pricebook_Entries</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Opportunity_Line_Items</name>
        <label>Create Opportunity Line Items</label>
        <locationX>2695</locationX>
        <locationY>829</locationY>
        <connector>
            <targetReference>Check_for_Promotions</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Update_w_error_message</targetReference>
        </faultConnector>
        <inputReference>oppLineItemCollection</inputReference>
    </recordCreates>
    <recordDeletes>
        <name>Delete_Old_Prods</name>
        <label>Delete Old Prods</label>
        <locationX>1614</locationX>
        <locationY>645</locationY>
        <connector>
            <targetReference>ResetBox_Update_Check</targetReference>
        </connector>
        <inputReference>ProductsToDelete</inputReference>
    </recordDeletes>
    <recordLookups>
        <name>Get_401_k_PB</name>
        <label>Get 401(k) PB</label>
        <locationX>466</locationX>
        <locationY>1073</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Verify_PB_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Standard 401(k)</stringValue>
            </value>
        </filters>
        <object>Pricebook2</object>
        <outputAssignments>
            <assignToReference>priceBookId</assignToReference>
            <field>Id</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>priceBookName</assignToReference>
            <field>Name</field>
        </outputAssignments>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_Add_On_PB</name>
        <label>Get Add-On PB</label>
        <locationX>341</locationX>
        <locationY>1521</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Verify_PB_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Add-On Products</stringValue>
            </value>
        </filters>
        <object>Pricebook2</object>
        <outputAssignments>
            <assignToReference>priceBookId</assignToReference>
            <field>Id</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>priceBookName</assignToReference>
            <field>Name</field>
        </outputAssignments>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_JPM_PB</name>
        <label>Get JPM PB</label>
        <locationX>245</locationX>
        <locationY>1741</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Verify_PB_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>JPM</stringValue>
            </value>
        </filters>
        <object>Pricebook2</object>
        <outputAssignments>
            <assignToReference>priceBookId</assignToReference>
            <field>Id</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>priceBookName</assignToReference>
            <field>Name</field>
        </outputAssignments>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_Products_0</name>
        <label>Get Products</label>
        <locationX>51</locationX>
        <locationY>1512</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Price_Book</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <object>OpportunityLineItem</object>
        <outputReference>ProductsToDelete</outputReference>
        <queriedFields>Id</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Relevant_Products</name>
        <label>Get Relevant Products</label>
        <locationX>843</locationX>
        <locationY>1393</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Add_Core_to_Collection</targetReference>
        </connector>
        <filterLogic>1 AND 2 AND 3 AND NOT 4</filterLogic>
        <filters>
            <field>Name</field>
            <operator>StartsWith</operator>
            <value>
                <elementReference>formattedServiceOption</elementReference>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>EndsWith</operator>
            <value>
                <elementReference>employeeCount</elementReference>
            </value>
        </filters>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Lite</stringValue>
            </value>
        </filters>
        <object>Product2</object>
        <outputReference>newCoreProduct</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>ProductCode</queriedFields>
        <queriedFields>Family</queriedFields>
        <queriedFields>IsActive</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_RewardJet_PB</name>
        <label>Get RewardJet PB</label>
        <locationX>364</locationX>
        <locationY>1649</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Verify_PB_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>RewardJet</stringValue>
            </value>
        </filters>
        <object>Pricebook2</object>
        <outputAssignments>
            <assignToReference>priceBookId</assignToReference>
            <field>Id</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>priceBookName</assignToReference>
            <field>Name</field>
        </outputAssignments>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_Rippling_PB</name>
        <label>Get Rippling PB</label>
        <locationX>511</locationX>
        <locationY>1709</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Verify_PB_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Rippling</stringValue>
            </value>
        </filters>
        <object>Pricebook2</object>
        <outputAssignments>
            <assignToReference>priceBookId</assignToReference>
            <field>Id</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>priceBookName</assignToReference>
            <field>Name</field>
        </outputAssignments>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_Sallus_PB</name>
        <label>Get Sallus PB</label>
        <locationX>537</locationX>
        <locationY>999</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Verify_PB_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Sallus Retirement</stringValue>
            </value>
        </filters>
        <object>Pricebook2</object>
        <outputAssignments>
            <assignToReference>priceBookId</assignToReference>
            <field>Id</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>priceBookName</assignToReference>
            <field>Name</field>
        </outputAssignments>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_Simply_PB</name>
        <label>Get Simply PB</label>
        <locationX>317</locationX>
        <locationY>1226</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Verify_PB_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Simply Retirement</stringValue>
            </value>
        </filters>
        <object>Pricebook2</object>
        <outputAssignments>
            <assignToReference>priceBookId</assignToReference>
            <field>Id</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>priceBookName</assignToReference>
            <field>Name</field>
        </outputAssignments>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_Single_k_PB</name>
        <label>Get Single(k) PB</label>
        <locationX>391</locationX>
        <locationY>1137</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Verify_PB_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Single(k)</stringValue>
            </value>
        </filters>
        <object>Pricebook2</object>
        <outputAssignments>
            <assignToReference>priceBookId</assignToReference>
            <field>Id</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>priceBookName</assignToReference>
            <field>Name</field>
        </outputAssignments>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_Upgrade_PB</name>
        <label>Get Upgrade PB</label>
        <locationX>611</locationX>
        <locationY>1833</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Verify_PB_Found</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Upgrade</stringValue>
            </value>
        </filters>
        <object>Pricebook2</object>
        <outputAssignments>
            <assignToReference>priceBookId</assignToReference>
            <field>Id</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>priceBookName</assignToReference>
            <field>Name</field>
        </outputAssignments>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Grab_Potential_Companions</name>
        <label>Grab Potential Companions</label>
        <locationX>530</locationX>
        <locationY>836</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Companion_Loop</targetReference>
        </connector>
        <filterLogic>((1 AND 3) OR 4 OR 5) AND 2</filterLogic>
        <filters>
            <field>Family</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Setup</stringValue>
            </value>
        </filters>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>ProductCode</field>
            <operator>In</operator>
            <value>
                <elementReference>coreCodeCollection</elementReference>
            </value>
        </filters>
        <filters>
            <field>Family</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Conversion</stringValue>
            </value>
        </filters>
        <filters>
            <field>Family</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>New Comp</stringValue>
            </value>
        </filters>
        <object>Product2</object>
        <outputReference>potentialCompanionProducts</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>ProductCode</queriedFields>
        <queriedFields>IsActive</queriedFields>
        <queriedFields>Family</queriedFields>
        <queriedFields>Name</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Grab_Prev_Upgrade_Product</name>
        <label>Grab Prev Upgrade Product</label>
        <locationX>762</locationX>
        <locationY>2006</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Upgrade_Products_Found_Check</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Name</field>
            <operator>StartsWith</operator>
            <value>
                <elementReference>formattedPrevServiceOption</elementReference>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>EndsWith</operator>
            <value>
                <elementReference>employeeCountPrev</elementReference>
            </value>
        </filters>
        <filters>
            <field>Pricebook2Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>priceBookId</elementReference>
            </value>
        </filters>
        <object>PricebookEntry</object>
        <outputReference>prevUpgradePBentry</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>UnitPrice</queriedFields>
        <queriedFields>Product2Id</queriedFields>
    </recordLookups>
    <recordLookups>
        <description>verify that prods we&apos;re about to create have entries</description>
        <name>Grab_Pricebook_Entries</name>
        <label>Grab Pricebook Entries</label>
        <locationX>1010</locationX>
        <locationY>974</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>purge_product_ids</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Pricebook2Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>priceBookId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Product2Id</field>
            <operator>In</operator>
            <value>
                <elementReference>productIdCollection</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>PricebookEntry</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Product2Id</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Grab_Upgrade_Product</name>
        <label>Grab Upgrade Product</label>
        <locationX>757</locationX>
        <locationY>1710</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Grab_Prev_Upgrade_Product</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Name</field>
            <operator>StartsWith</operator>
            <value>
                <elementReference>formattedServiceOption</elementReference>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>EndsWith</operator>
            <value>
                <elementReference>employeeCount</elementReference>
            </value>
        </filters>
        <filters>
            <field>Pricebook2Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>priceBookId</elementReference>
            </value>
        </filters>
        <object>PricebookEntry</object>
        <outputReference>UpgradePBentry</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>UnitPrice</queriedFields>
        <queriedFields>Product2Id</queriedFields>
    </recordLookups>
    <recordUpdates>
        <name>Update_Triggering_Opp</name>
        <label>Update Triggering Opp</label>
        <locationX>2396</locationX>
        <locationY>676</locationY>
        <connector>
            <targetReference>Create_Opportunity_Line_Items</targetReference>
        </connector>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_w_error_message</name>
        <label>Update w/ error message</label>
        <locationX>2897</locationX>
        <locationY>686</locationY>
        <inputAssignments>
            <field>Opportunity_Notes__c</field>
            <value>
                <elementReference>productErrorMessage</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>151</locationX>
        <locationY>802</locationY>
        <connector>
            <targetReference>Entry_Validation</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Type</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Ancillary Billing Hourly Rate</stringValue>
            </value>
        </filters>
        <filters>
            <field>Type</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Ancillary Billing Flat Fee</stringValue>
            </value>
        </filters>
        <filters>
            <field>Type</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Plan Amendment</stringValue>
            </value>
        </filters>
        <filters>
            <field>Type</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Add-on Product</stringValue>
            </value>
        </filters>
        <filters>
            <field>Product_Type__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Add-On Product</stringValue>
            </value>
        </filters>
        <filters>
            <field>Product_Type__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Plan Amendment</stringValue>
            </value>
        </filters>
        <filters>
            <field>Service_Option__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <object>Opportunity</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Obsolete</status>
    <subflows>
        <name>Check_for_Promotions</name>
        <label>Check for Promotions</label>
        <locationX>2688</locationX>
        <locationY>1139</locationY>
        <flowName>Update_Promotional_Discount</flowName>
        <inputAssignments>
            <name>recordId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <textTemplates>
        <name>productErrorMessage</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!$Flow.CurrentDate} - Failed to find product(s) in opportunity&apos;s pricebook.
Pricebook: {!priceBookName}
Product(s): {!productErrorList}

{!$Record.Opportunity_Notes__c}</text>
    </textTemplates>
    <variables>
        <name>coreCodeCollection</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>Discount</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>DiscountAmount</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>newCoreProduct</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Product2</objectType>
    </variables>
    <variables>
        <name>oppLineItem</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>oppLineItemCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>oppUpgradeLineItem</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>oppUpgradePrevLineItem</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>potentialCompanionProducts</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Product2</objectType>
    </variables>
    <variables>
        <name>prevUpgradePBentry</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>PricebookEntry</objectType>
    </variables>
    <variables>
        <name>priceBookId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>priceBookName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>prodCodeVariable</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>productErrorList</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>productIdCollection</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>products2Add</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Product2</objectType>
    </variables>
    <variables>
        <name>ProductsToDelete</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>UpgradePBentry</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>PricebookEntry</objectType>
    </variables>
</Flow>
