<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>56.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Add_Opp_Amount</name>
        <label>Add Opp Amount</label>
        <locationX>534</locationX>
        <locationY>684</locationY>
        <assignmentItems>
            <assignToReference>TotalAmount</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Addition_Loop.Amount</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TotalPlans</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Addition_Loop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Add_Opp_to_Null_Forecast</name>
        <label>Add Opp to Null Forecast</label>
        <locationX>798</locationX>
        <locationY>792</locationY>
        <assignmentItems>
            <assignToReference>NeedForecastReset</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Addition_Loop</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Addition_Loop</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Mark_Opp_for_Reset</name>
        <label>Mark Opp for Reset</label>
        <locationX>798</locationX>
        <locationY>684</locationY>
        <assignmentItems>
            <assignToReference>Addition_Loop.Forecast__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <connector>
            <targetReference>Add_Opp_to_Null_Forecast</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Forecast_Needs_Zeroing</name>
        <label>Forecast Needs Zeroing</label>
        <locationX>1238</locationX>
        <locationY>468</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Needs_Zero</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Actual_Revenue__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Actual_Plan_Sales__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Zero_Out_Forecast</targetReference>
            </connector>
            <label>Needs Zero</label>
        </rules>
    </decisions>
    <decisions>
        <name>Forecast_Totals_Check</name>
        <label>Forecast Totals Check</label>
        <locationX>446</locationX>
        <locationY>1368</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Both_Updates_Needed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>TotalAmount</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Actual_Revenue__c</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>TotalPlans</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Actual_Plan_Sales__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Both</targetReference>
            </connector>
            <label>Both Updates Needed</label>
        </rules>
        <rules>
            <name>Amount_Update_Needed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>TotalAmount</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Actual_Revenue__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Amount</targetReference>
            </connector>
            <label>Amount Update Needed</label>
        </rules>
        <rules>
            <name>Plan_Count_Update_Needed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>TotalPlans</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Actual_Plan_Sales__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Plan_Count</targetReference>
            </connector>
            <label>Plan Count Update Needed</label>
        </rules>
    </decisions>
    <decisions>
        <name>Opp_in_correct_forecast</name>
        <label>Opp in correct forecast</label>
        <locationX>666</locationX>
        <locationY>576</locationY>
        <defaultConnector>
            <targetReference>Mark_Opp_for_Reset</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Mismatch</defaultConnectorLabel>
        <rules>
            <name>Forecast_Match</name>
            <conditionLogic>2 AND 3 AND (1 OR (4 AND 5) OR (6 AND 7))</conditionLogic>
            <conditions>
                <leftValueReference>ChannelLeadSourceText</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Addition_Loop.LeadSource</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Addition_Loop.CloseDate</leftValueReference>
                <operator>LessThanOrEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.End_Date__c</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Addition_Loop.CloseDate</leftValueReference>
                <operator>GreaterThanOrEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Start_Date__c</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>productTypeBucket</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Expansion</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Forecast_Plan__r.Product__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Expansion</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Forecast_Plan__r.Forecast_Channel__r.Partner_Referral_Source__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>forecastChannelLSDtext</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Addition_Loop.LeadSourceDetail__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Add_Opp_Amount</targetReference>
            </connector>
            <label>Forecast Match</label>
        </rules>
    </decisions>
    <decisions>
        <name>Opps_Found_Check</name>
        <label>Opps Found Check</label>
        <locationX>842</locationX>
        <locationY>360</locationY>
        <defaultConnector>
            <targetReference>Forecast_Needs_Zeroing</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Opps_In_Collection</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>OppRecs</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Addition_Loop</targetReference>
            </connector>
            <label>Opps In Collection</label>
        </rules>
    </decisions>
    <decisions>
        <name>Opps_to_reset_check</name>
        <label>Opps to reset check</label>
        <locationX>446</locationX>
        <locationY>1068</locationY>
        <defaultConnector>
            <targetReference>Forecast_Totals_Check</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Opps_Needing_Reset</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>NeedForecastReset</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Reset_Opp_Forecasts</targetReference>
            </connector>
            <label>Opps Needing Reset</label>
        </rules>
    </decisions>
    <description>:^(</description>
    <environments>Default</environments>
    <formulas>
        <name>productTypeBucket</name>
        <dataType>String</dataType>
        <expression>IF(
ISPICKVAL({!Addition_Loop.Product_Type__c}, &quot;Upgrade&quot;)||ISPICKVAL({!Addition_Loop.Product_Type__c}, &quot;Plan Amendment&quot;)||ISPICKVAL({!Addition_Loop.Product_Type__c}, &quot;Add-On Product&quot;)||ISPICKVAL({!Addition_Loop.Product_Type__c}, &quot;Product Downgrade&quot;),&quot;Expansion&quot;,
IF(ISPICKVAL({!Addition_Loop.Product_Type__c},&quot;PEP&quot;),&quot;401(k)&quot;,TEXT({!Addition_Loop.Product_Type__c})))</expression>
    </formulas>
    <formulas>
        <name>TodayLess6mo</name>
        <dataType>Date</dataType>
        <expression>ADDMONTHS(TODAY(),-6)</expression>
    </formulas>
    <interviewLabel>Forecast | Scheduled | ONE TIME Sync Actual Numbers3 {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Forecast | Scheduled | ONE TIME Sync Actual Numbers3</label>
    <loops>
        <name>Addition_Loop</name>
        <label>Addition Loop</label>
        <locationX>446</locationX>
        <locationY>468</locationY>
        <collectionReference>OppRecs</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Opp_in_correct_forecast</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Opps_to_reset_check</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Grab_related_ops</name>
        <label>Grab related ops</label>
        <locationX>842</locationX>
        <locationY>252</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Opps_Found_Check</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Forecast__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>StageName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Closed Won</stringValue>
            </value>
        </filters>
        <object>Opportunity</object>
        <outputReference>OppRecs</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Amount</queriedFields>
        <queriedFields>LeadSource</queriedFields>
        <queriedFields>CloseDate</queriedFields>
        <queriedFields>Product_Type__c</queriedFields>
    </recordLookups>
    <recordUpdates>
        <name>Reset_Opp_Forecasts</name>
        <label>Reset Opp Forecasts</label>
        <locationX>314</locationX>
        <locationY>1176</locationY>
        <connector>
            <targetReference>Forecast_Totals_Check</targetReference>
        </connector>
        <inputReference>NeedForecastReset</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Amount</name>
        <label>Update Amount</label>
        <locationX>314</locationX>
        <locationY>1476</locationY>
        <inputAssignments>
            <field>Actual_Revenue__c</field>
            <value>
                <elementReference>TotalAmount</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Both</name>
        <label>Update Both</label>
        <locationX>50</locationX>
        <locationY>1476</locationY>
        <inputAssignments>
            <field>Actual_Plan_Sales__c</field>
            <value>
                <elementReference>TotalPlans</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Actual_Revenue__c</field>
            <value>
                <elementReference>TotalAmount</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Plan_Count</name>
        <label>Update Plan Count</label>
        <locationX>578</locationX>
        <locationY>1476</locationY>
        <inputAssignments>
            <field>Actual_Plan_Sales__c</field>
            <value>
                <elementReference>TotalPlans</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Zero_Out_Forecast</name>
        <label>Zero Out Forecast</label>
        <locationX>1106</locationX>
        <locationY>576</locationY>
        <inputAssignments>
            <field>Actual_Plan_Sales__c</field>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Actual_Revenue__c</field>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>716</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Grab_related_ops</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <stringValue>Unforecast</stringValue>
            </value>
        </filters>
        <filters>
            <field>Start_Date__c</field>
            <operator>GreaterThanOrEqualTo</operator>
            <value>
                <dateValue>2024-04-01</dateValue>
            </value>
        </filters>
        <object>Forecast__c</object>
        <schedule>
            <frequency>Once</frequency>
            <startDate>2024-05-14</startDate>
            <startTime>09:15:00.000Z</startTime>
        </schedule>
        <triggerType>Scheduled</triggerType>
    </start>
    <status>Obsolete</status>
    <variables>
        <name>ChannelLeadSourceText</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <elementReference>$Record.Forecast_Plan__r.Forecast_Channel__r.Lead_Source__c</elementReference>
        </value>
    </variables>
    <variables>
        <name>forecastChannelLSDtext</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <elementReference>$Record.Forecast_Plan__r.Forecast_Channel__r.Lead_Source_Detail__c</elementReference>
        </value>
    </variables>
    <variables>
        <name>NeedForecastReset</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>OppRecs</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <name>TotalAmount</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>TotalPlans</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
</Flow>
