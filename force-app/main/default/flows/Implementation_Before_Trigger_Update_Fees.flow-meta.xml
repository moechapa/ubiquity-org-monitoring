<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>54.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>Assign_Sallus_EE_Fee</name>
        <label>Assign Sallus EE Fee</label>
        <locationX>578</locationX>
        <locationY>2003</locationY>
        <assignmentItems>
            <assignToReference>employeeFeeVar</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>4.5</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Employee_Fees</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Simply_EE_Fee</name>
        <label>Assign Simply EE Fee</label>
        <locationX>314</locationX>
        <locationY>2003</locationY>
        <assignmentItems>
            <assignToReference>employeeFeeVar</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>6.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Employee_Fees</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_UBQT_EE_Fee</name>
        <label>Assign UBQT EE Fee</label>
        <locationX>50</locationX>
        <locationY>2003</locationY>
        <assignmentItems>
            <assignToReference>employeeFeeVar</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>6.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Employee_Fees</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_if_fee_update_needed</name>
        <label>Check if fee update needed</label>
        <locationX>556</locationX>
        <locationY>503</locationY>
        <defaultConnector>
            <targetReference>Missing_Grandfather_Date</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Needs_Quarter_Fee_Update</name>
            <conditionLogic>1 AND (2 OR 3)</conditionLogic>
            <conditions>
                <leftValueReference>oppItemRec.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>qrtrFee</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Quarterly_Fees__c</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>qrtrFee</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Quarterly_Fees</targetReference>
            </connector>
            <label>Needs Quarter Fee Update</label>
        </rules>
    </decisions>
    <decisions>
        <name>Does_Advisor_Cred_need_update</name>
        <label>Does Advisor Cred need update</label>
        <locationX>556</locationX>
        <locationY>1403</locationY>
        <defaultConnector>
            <targetReference>Employee_Fees_Needed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Update_to_green_AND_Onedigital</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.X3_38__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Opportunity_Name__r.X3_38__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>OneDigital</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Green_Onedigital</targetReference>
            </connector>
            <label>Update to green AND Onedigital</label>
        </rules>
        <rules>
            <name>Wilshire_3_38</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.X3_38__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Opportunity_Name__r.X3_38__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Wilshire</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Wilshire</targetReference>
            </connector>
            <label>Wilshire 3(38)</label>
        </rules>
    </decisions>
    <decisions>
        <name>Employee_Brand</name>
        <label>Employee Brand</label>
        <locationX>446</locationX>
        <locationY>1895</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>UBQT</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Brand__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Ubiquity Retirement + Savings</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_UBQT_EE_Fee</targetReference>
            </connector>
            <label>UBQT</label>
        </rules>
        <rules>
            <name>Simply</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Brand__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Simply Retirement</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Simply_EE_Fee</targetReference>
            </connector>
            <label>Simply</label>
        </rules>
        <rules>
            <name>Sallus</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Brand__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Sallus Retirement</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Sallus_EE_Fee</targetReference>
            </connector>
            <label>Sallus</label>
        </rules>
    </decisions>
    <decisions>
        <name>Employee_Fees_Needed</name>
        <label>Employee Fees Needed</label>
        <locationX>776</locationX>
        <locationY>1787</locationY>
        <defaultConnectorLabel>Employee Fees Present</defaultConnectorLabel>
        <rules>
            <name>Employee_Fees_Null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Employee_Monthly_Fees__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Opportunity_Name__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Employee_Brand</targetReference>
            </connector>
            <label>Employee Fees Null</label>
        </rules>
    </decisions>
    <decisions>
        <name>Grandfather_Date_Check</name>
        <label>Grandfather Date Check</label>
        <locationX>402</locationX>
        <locationY>1019</locationY>
        <defaultConnector>
            <targetReference>Does_Advisor_Cred_need_update</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Grandfather_Date_Update_Needed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>propGrandfatherDate</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>propGrandfatherDate</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Grandfather_Date__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Imp_Grandfather_Date</targetReference>
            </connector>
            <label>Grandfather Date Update Needed</label>
        </rules>
    </decisions>
    <decisions>
        <name>Missing_Grandfather_Date</name>
        <label>Missing Grandfather Date</label>
        <locationX>556</locationX>
        <locationY>803</locationY>
        <defaultConnector>
            <targetReference>Does_Advisor_Cred_need_update</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Find_Matching_Proposal</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Grandfather_Date__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Service_Option__c</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>Simply Retirement</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Find_Proposal</targetReference>
            </connector>
            <label>Find Matching Proposal</label>
        </rules>
    </decisions>
    <decisions>
        <name>Quarterly_Fees_Needed</name>
        <label>Quarterly Fees Needed</label>
        <locationX>776</locationX>
        <locationY>287</locationY>
        <defaultConnector>
            <targetReference>Employee_Fees_Needed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Quarterly Fees Not Needed</defaultConnectorLabel>
        <rules>
            <name>Quarterly_Fees_Necessary</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Opportunity_Name__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.CreatedDate</leftValueReference>
                <operator>GreaterThanOrEqualTo</operator>
                <rightValue>
                    <elementReference>oneWeekAgo</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Opp_Products</targetReference>
            </connector>
            <label>Quarterly Fees Necessary</label>
        </rules>
    </decisions>
    <description>Updated so employee fee for Sallus is 4.5 (from 9)</description>
    <environments>Default</environments>
    <formulas>
        <name>oneWeekAgo</name>
        <dataType>Date</dataType>
        <expression>TODAY() - 7</expression>
    </formulas>
    <formulas>
        <name>qrtrFee</name>
        <dataType>Currency</dataType>
        <expression>{!oppItemRec.UnitPrice}/4</expression>
        <scale>2</scale>
    </formulas>
    <interviewLabel>Implementation | Before Trigger | Update Fees {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Implementation | Before Trigger | Update Fees</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Find_Proposal</name>
        <label>Find Proposal</label>
        <locationX>402</locationX>
        <locationY>911</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Grandfather_Date_Check</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Opportunity__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Opportunity_Name__c</elementReference>
            </value>
        </filters>
        <object>Proposal__c</object>
        <outputAssignments>
            <assignToReference>propGrandfatherDate</assignToReference>
            <field>Grandfather_Date__c</field>
        </outputAssignments>
    </recordLookups>
    <recordLookups>
        <name>Get_Opp_Products</name>
        <label>Get Opp Products</label>
        <locationX>556</locationX>
        <locationY>395</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_if_fee_update_needed</targetReference>
        </connector>
        <filterLogic>(1 OR 3) AND 2</filterLogic>
        <filters>
            <field>Product_Family__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>401(k)</stringValue>
            </value>
        </filters>
        <filters>
            <field>OpportunityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Opportunity_Name__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Product_Family__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Single(k)</stringValue>
            </value>
        </filters>
        <object>OpportunityLineItem</object>
        <outputReference>oppItemRec</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>UnitPrice</queriedFields>
    </recordLookups>
    <recordUpdates>
        <name>Green_Onedigital</name>
        <label>Green Onedigital</label>
        <locationX>292</locationX>
        <locationY>1511</locationY>
        <connector>
            <targetReference>Employee_Fees_Needed</targetReference>
        </connector>
        <inputAssignments>
            <field>Simply_Credentialed_Advisor__c</field>
            <value>
                <stringValue>Green</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>X3_38__c</field>
            <value>
                <stringValue>OneDigital</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Employee_Fees</name>
        <label>Update Employee Fees</label>
        <locationX>446</locationX>
        <locationY>2195</locationY>
        <inputAssignments>
            <field>Employee_Monthly_Fees__c</field>
            <value>
                <elementReference>employeeFeeVar</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Imp_Grandfather_Date</name>
        <label>Update Imp Grandfather Date</label>
        <locationX>270</locationX>
        <locationY>1127</locationY>
        <connector>
            <targetReference>Does_Advisor_Cred_need_update</targetReference>
        </connector>
        <inputAssignments>
            <field>Grandfather_Date__c</field>
            <value>
                <elementReference>propGrandfatherDate</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Quarterly_Fees</name>
        <label>Update Quarterly Fees</label>
        <locationX>424</locationX>
        <locationY>611</locationY>
        <connector>
            <targetReference>Missing_Grandfather_Date</targetReference>
        </connector>
        <inputAssignments>
            <field>Quarterly_Fees__c</field>
            <value>
                <elementReference>qrtrFee</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Wilshire</name>
        <label>Wilshire</label>
        <locationX>556</locationX>
        <locationY>1511</locationY>
        <connector>
            <targetReference>Employee_Fees_Needed</targetReference>
        </connector>
        <inputAssignments>
            <field>X3_38__c</field>
            <value>
                <stringValue>Wilshire</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>650</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Quarterly_Fees_Needed</targetReference>
        </connector>
        <object>Implementation__c</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordBeforeSave</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <name>employeeFeeVar</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>oppItemRec</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <name>propGrandfatherDate</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
